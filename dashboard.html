<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hunter Pro CRM | Ultimate</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f0f2f5; }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
        }
        
        /* Animations */
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.5s ease-out forwards; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        /* Mobile Nav Active State */
        .nav-active { color: #2563eb; position: relative; }
        .nav-active::after {
            content: ''; position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
            width: 40px; height: 4px; background: #2563eb; border-radius: 0 0 4px 4px;
        }
        
        /* Safe Area for Mobile */
        .pb-safe { padding-bottom: calc(80px + env(safe-area-inset-bottom)); }
    </style>
</head>
<body class="text-slate-800 antialiased h-screen flex overflow-hidden selection:bg-blue-100">

    <aside class="w-72 bg-white h-full hidden md:flex flex-col z-20 border-l border-gray-100 shadow-xl">
        <div class="p-6 flex items-center gap-3 border-b border-gray-50">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-blue-600 to-indigo-600 text-white flex items-center justify-center text-xl shadow-lg shadow-blue-200">
                <i class="fa-solid fa-crosshairs"></i>
            </div>
            <div>
                <h1 class="text-xl font-extrabold text-slate-800 tracking-tight">Hunter Pro</h1>
                <span class="text-[10px] font-bold bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full border border-blue-100">V 3.0 PRO</span>
            </div>
        </div>

        <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
            <button onclick="nav('dashboard')" id="desk-dashboard" class="desk-item w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-500 hover:bg-slate-50 hover:text-blue-600 transition-all font-medium group">
                <div class="w-8 h-8 rounded-lg bg-slate-100 group-hover:bg-blue-100 flex items-center justify-center transition-colors"><i class="fa-solid fa-chart-pie"></i></div>
                Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </button>
            <button onclick="nav('hunt')" id="desk-hunt" class="desk-item w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-500 hover:bg-slate-50 hover:text-blue-600 transition-all font-medium group">
                <div class="w-8 h-8 rounded-lg bg-slate-100 group-hover:bg-blue-100 flex items-center justify-center transition-colors"><i class="fa-solid fa-gem"></i></div>
                Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø«
            </button>
            <button onclick="nav('leads')" id="desk-leads" class="desk-item w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-500 hover:bg-slate-50 hover:text-blue-600 transition-all font-medium group">
                <div class="w-8 h-8 rounded-lg bg-slate-100 group-hover:bg-blue-100 flex items-center justify-center transition-colors"><i class="fa-solid fa-users"></i></div>
                Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            </button>
            <button onclick="nav('campaigns')" id="desk-campaigns" class="desk-item w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-500 hover:bg-slate-50 hover:text-blue-600 transition-all font-medium group">
                <div class="w-8 h-8 rounded-lg bg-slate-100 group-hover:bg-blue-100 flex items-center justify-center transition-colors"><i class="fa-brands fa-whatsapp"></i></div>
                Ø§Ù„ØªØ³ÙˆÙŠÙ‚
            </button>
        </nav>

        <div class="p-4 border-t border-gray-50">
            <button onclick="logout()" class="w-full bg-red-50 text-red-600 py-3 rounded-xl hover:bg-red-100 transition flex items-center justify-center gap-2 font-bold text-sm">
                <i class="fa-solid fa-arrow-right-from-bracket"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </aside>

    <main class="flex-1 h-full overflow-y-auto w-full relative pb-safe">
        
        <header class="md:hidden glass sticky top-0 z-30 px-4 py-3 flex justify-between items-center shadow-sm">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-blue-600 text-white flex items-center justify-center"><i class="fa-solid fa-crosshairs"></i></div>
                <h1 class="font-bold text-lg text-slate-800">Hunter Pro</h1>
            </div>
            <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden border-2 border-white shadow-sm">
                <img src="https://ui-avatars.com/api/?name=Admin&background=0D8ABC&color=fff" alt="Admin">
            </div>
        </header>

        <div class="p-4 md:p-8 max-w-7xl mx-auto space-y-6">

            <section id="section-dashboard" class="page-section animate-slide-up">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±ØŒ Ø£Ø¯Ù…Ù† ğŸ‘‹</h2>
                        <p class="text-slate-500 text-sm mt-1">Ø¥Ù„ÙŠÙƒ Ù…Ù„Ø®Øµ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</p>
                    </div>
                    <button onclick="loadData()" class="bg-white p-2 rounded-lg text-slate-500 shadow-sm border hover:text-blue-600"><i class="fa-solid fa-rotate"></i></button>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="glass p-5 rounded-2xl flex flex-col gap-2">
                        <div class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center text-lg"><i class="fa-solid fa-users"></i></div>
                        <span class="text-slate-400 text-xs font-medium">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯</span>
                        <h3 class="text-2xl font-bold text-slate-800" id="kpi-leads">--</h3>
                    </div>
                    <div class="glass p-5 rounded-2xl flex flex-col gap-2">
                        <div class="w-10 h-10 rounded-full bg-green-50 text-green-600 flex items-center justify-center text-lg"><i class="fa-brands fa-whatsapp"></i></div>
                        <span class="text-slate-400 text-xs font-medium">Ø±Ø³Ø§Ø¦Ù„ Ù…Ø±Ø³Ù„Ø©</span>
                        <h3 class="text-2xl font-bold text-slate-800" id="kpi-msgs">--</h3>
                    </div>
                    <div class="glass p-5 rounded-2xl flex flex-col gap-2">
                        <div class="w-10 h-10 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center text-lg"><i class="fa-solid fa-gem"></i></div>
                        <span class="text-slate-400 text-xs font-medium">ÙØ±Øµ Ù…Ù…ØªØ§Ø²Ø©</span>
                        <h3 class="text-2xl font-bold text-slate-800" id="kpi-hot">--</h3>
                    </div>
                    <div class="glass p-5 rounded-2xl flex flex-col gap-2">
                        <div class="w-10 h-10 rounded-full bg-orange-50 text-orange-600 flex items-center justify-center text-lg"><i class="fa-solid fa-bolt"></i></div>
                        <span class="text-slate-400 text-xs font-medium">Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø«</span>
                        <h3 class="text-2xl font-bold text-slate-800" id="kpi-hunts">--</h3>
                    </div>
                </div>

                <div class="glass p-6 rounded-3xl shadow-sm mb-8 border border-white/60">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2"><i class="fa-solid fa-chart-area text-blue-500"></i> ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡</h3>
                    <div class="h-64 w-full">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="section-hunt" class="page-section hidden animate-slide-up">
                <div class="bg-slate-900 rounded-[2rem] p-6 md:p-10 text-white relative overflow-hidden shadow-2xl mb-8">
                    <div class="absolute -top-24 -right-24 w-64 h-64 bg-blue-500 rounded-full blur-3xl opacity-20"></div>
                    <div class="absolute -bottom-24 -left-24 w-64 h-64 bg-purple-500 rounded-full blur-3xl opacity-20"></div>
                    
                    <div class="relative z-10">
                        <h2 class="text-3xl font-bold mb-2">Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ</h2>
                        <p class="text-gray-400 text-sm mb-6">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù…Ù„Ø§Ø¡ Ø­Ù‚ÙŠÙ‚ÙŠÙŠÙ† ÙÙŠ Ø«ÙˆØ§Ù†ÙŠ</p>
                        
                        <div class="space-y-4">
                            <div class="relative">
                                <i class="fa-solid fa-magnifying-glass absolute top-4 right-4 text-gray-400"></i>
                                <input type="text" id="hunt-q" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø·Ù„ÙˆØ¨ Ø´Ø±Ø§Ø¡ Ø´Ù‚Ø© ÙÙŠ Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„Ø®Ø§Ù…Ø³" 
                                    class="w-full bg-white/10 border border-white/20 rounded-xl py-3.5 pr-12 pl-4 text-white placeholder-gray-400 focus:outline-none focus:bg-white/20 focus:border-blue-400 transition">
                            </div>
                            <div class="flex gap-3">
                                <select id="hunt-loc" class="flex-1 bg-white/10 border border-white/20 rounded-xl py-3 px-4 text-white focus:outline-none [&>option]:text-black">
                                    <option value="Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
                                    <option value="Ø§Ù„Ø¬ÙŠØ²Ø©">Ø§Ù„Ø¬ÙŠØ²Ø©</option>
                                    <option value="Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                                </select>
                                <button onclick="startHunt()" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-600/30 transition transform active:scale-95">
                                    Ø¨Ø¯Ø¡ Ø§Ù„ØµÙŠØ¯ ğŸš€
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="glass p-5 rounded-2xl border hover:border-blue-200 transition cursor-pointer" onclick="openExtractModal()">
                        <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center text-purple-600 text-xl mb-3"><i class="fa-solid fa-file-lines"></i></div>
                        <h4 class="font-bold text-sm">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ù† Ù†Øµ</h4>
                        <p class="text-xs text-gray-400 mt-1">Ù†Ø³Ø® ÙˆÙ„ØµÙ‚</p>
                    </div>
                    <div class="glass p-5 rounded-2xl border hover:border-green-200 transition cursor-pointer">
                        <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-green-600 text-xl mb-3"><i class="fa-solid fa-file-excel"></i></div>
                        <h4 class="font-bold text-sm">ØªØµØ¯ÙŠØ± Excel</h4>
                        <p class="text-xs text-gray-400 mt-1">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                    </div>
                </div>
            </section>

            <section id="section-leads" class="page-section hidden animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
                    <div class="flex gap-2">
                        <button class="bg-white px-3 py-2 rounded-lg text-sm border shadow-sm"><i class="fa-solid fa-filter"></i></button>
                        <button class="bg-blue-600 text-white px-3 py-2 rounded-lg text-sm shadow-lg shadow-blue-600/20"><i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ©</button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-right text-sm">
                            <thead class="bg-gray-50 text-gray-500 font-medium">
                                <tr>
                                    <th class="px-6 py-4">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th class="px-6 py-4">Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                                    <th class="px-6 py-4">Ø§Ù„Ù…ØµØ¯Ø±</th>
                                    <th class="px-6 py-4">Ø¥Ø¬Ø±Ø§Ø¡</th>
                                </tr>
                            </thead>
                            <tbody id="leads-list" class="divide-y divide-gray-100">
                                <tr><td colspan="4" class="text-center py-8 text-gray-400">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="section-campaigns" class="page-section hidden animate-slide-up">
                <h2 class="text-2xl font-bold text-slate-800 mb-6">Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ©</h2>
                
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-6">
                    <h3 class="font-bold mb-4 flex items-center gap-2"><i class="fa-solid fa-wand-magic-sparkles text-yellow-500"></i> Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                    <form onsubmit="createCamp(event)" class="space-y-4">
                        <input name="name" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:border-blue-500 transition" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ù…Ù„Ø©">
                        <textarea name="message" rows="3" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:border-blue-500 transition" placeholder="Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©..."></textarea>
                        <button class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold hover:bg-slate-800 transition">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©</button>
                    </form>
                </div>

                <div id="campaigns-container" class="space-y-3"></div>
            </section>

        </div>
    </main>

    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-lg border-t border-gray-200 z-50 pb-safe">
        <div class="flex justify-around items-center p-2">
            <button onclick="nav('dashboard')" id="mob-dashboard" class="nav-active flex flex-col items-center gap-1 p-2 w-16 transition-all">
                <i class="fa-solid fa-chart-pie text-xl"></i>
                <span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>
            <button onclick="nav('hunt')" id="mob-hunt" class="text-gray-400 flex flex-col items-center gap-1 p-2 w-16 transition-all">
                <i class="fa-solid fa-gem text-xl"></i>
                <span class="text-[10px] font-bold">Ø¨Ø­Ø«</span>
            </button>
            <div class="relative -top-5">
                <button onclick="openExtractModal()" class="w-14 h-14 rounded-full bg-blue-600 text-white flex items-center justify-center text-xl shadow-lg shadow-blue-600/40 transform active:scale-95 transition">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>
            <button onclick="nav('leads')" id="mob-leads" class="text-gray-400 flex flex-col items-center gap-1 p-2 w-16 transition-all">
                <i class="fa-solid fa-users text-xl"></i>
                <span class="text-[10px] font-bold">Ø¹Ù…Ù„Ø§Ø¡</span>
            </button>
            <button onclick="nav('campaigns')" id="mob-campaigns" class="text-gray-400 flex flex-col items-center gap-1 p-2 w-16 transition-all">
                <i class="fa-brands fa-whatsapp text-xl"></i>
                <span class="text-[10px] font-bold">Ø­Ù…Ù„Ø§Øª</span>
            </button>
        </div>
    </nav>

    <div id="modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl animate-slide-up">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø±Ù‚Ø§Ù…</h3>
                <button onclick="document.getElementById('modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <textarea id="ext-text" class="w-full h-32 bg-gray-50 rounded-xl p-3 text-sm mb-4 border focus:outline-none focus:border-blue-500" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..."></textarea>
            <button onclick="runExtraction()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">Ø§Ø³ØªØ®Ø±Ø§Ø¬</button>
            <div id="ext-res" class="mt-4 hidden p-3 bg-green-50 text-green-700 rounded-xl text-xs break-all"></div>
        </div>
    </div>

    <div id="login-screen" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center p-6">
        <div class="w-20 h-20 bg-blue-600 rounded-3xl flex items-center justify-center text-white text-4xl shadow-2xl shadow-blue-600/30 mb-8">
            <i class="fa-solid fa-crosshairs"></i>
        </div>
        <h1 class="text-3xl font-bold text-slate-800 mb-2">Hunter Pro</h1>
        <p class="text-slate-500 mb-8">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</p>
        
        <form onsubmit="doLogin(event)" class="w-full max-w-sm space-y-4">
            <div class="bg-gray-50 border border-gray-200 rounded-2xl px-4 py-3 flex items-center gap-3">
                <i class="fa-regular fa-envelope text-gray-400"></i>
                <input type="email" id="log-email" value="admin@example.com" class="bg-transparent w-full outline-none text-sm" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            </div>
            <div class="bg-gray-50 border border-gray-200 rounded-2xl px-4 py-3 flex items-center gap-3">
                <i class="fa-solid fa-lock text-gray-400"></i>
                <input type="password" id="log-pass" value="admin123" class="bg-transparent w-full outline-none text-sm" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            <button class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-xl shadow-blue-600/20 active:scale-95 transition">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</button>
        </form>
    </div>

    <script>
        const API = "";
        let chartInstance = null;

        // Init
        if(localStorage.getItem('token')) {
            document.getElementById('login-screen').classList.add('hidden');
            loadData();
        }

        // Navigation
        function nav(id) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`section-${id}`).classList.remove('hidden');
            
            // Mobile Nav
            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('nav-active', 'text-blue-600');
                b.classList.add('text-gray-400');
            });
            const mobBtn = document.getElementById(`mob-${id}`);
            if(mobBtn) {
                mobBtn.classList.remove('text-gray-400');
                mobBtn.classList.add('nav-active', 'text-blue-600');
            }
        }

        // Login
        async function doLogin(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const originalText = btn.innerText;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';
            
            try {
                const res = await fetch(`${API}/api/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        email: document.getElementById('log-email').value,
                        password: document.getElementById('log-pass').value
                    })
                });
                if(!res.ok) throw new Error();
                const data = await res.json();
                localStorage.setItem('token', data.access_token);
                
                document.getElementById('login-screen').classList.add('hidden');
                Swal.fire({icon: 'success', title: 'ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„', showConfirmButton: false, timer: 1500});
                loadData();
            } catch {
                btn.innerText = originalText;
                Swal.fire('Ø®Ø·Ø£', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
            }
        }

        function logout() { localStorage.clear(); location.reload(); }

        // Load Data
        async function loadData() {
            try {
                // Stats
                const stats = await (await fetch(`${API}/api/admin-stats`)).json();
                document.getElementById('kpi-leads').innerText = stats.total_leads || 0;
                document.getElementById('kpi-msgs').innerText = stats.total_messages || 0;
                document.getElementById('kpi-hunts').innerText = Math.floor(Math.random() * 50) + 10; // Simulation
                document.getElementById('kpi-hot').innerText = Math.floor((stats.total_leads || 0) * 0.3);

                // Leads
                const leads = await (await fetch(`${API}/api/leads`)).json();
                const tbody = document.getElementById('leads-list');
                if(leads.leads.length) {
                    tbody.innerHTML = leads.leads.map(l => `
                        <tr class="hover:bg-blue-50/50 transition">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 font-bold text-xs">${l.phone_number.slice(-2)}</div>
                                    <span class="font-bold text-slate-700">${l.phone_number}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2 py-1 rounded-md text-xs font-bold ${l.quality.includes('Ù…Ù…ØªØ§Ø²') ? 'bg-purple-100 text-purple-600' : 'bg-blue-100 text-blue-600'}">${l.quality}</span>
                            </td>
                            <td class="px-6 py-4 text-xs text-gray-500">${l.source}</td>
                            <td class="px-6 py-4">
                                <button onclick="sendMsg('${l.phone_number}')" class="text-green-500 hover:bg-green-100 p-2 rounded-lg transition"><i class="fa-brands fa-whatsapp text-lg"></i></button>
                            </td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center py-8 text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
                }

                // Campaigns
                const camps = await (await fetch(`${API}/api/my-campaigns?user_id=admin`)).json();
                document.getElementById('campaigns-container').innerHTML = camps.campaigns.map(c => `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex justify-between items-center shadow-sm">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-yellow-50 flex items-center justify-center text-yellow-600"><i class="fa-solid fa-bullhorn"></i></div>
                            <div>
                                <h4 class="font-bold text-slate-800">${c.name}</h4>
                                <p class="text-xs text-gray-400 line-clamp-1">${c.message}</p>
                            </div>
                        </div>
                        <button class="bg-blue-50 text-blue-600 px-3 py-1 rounded-lg text-xs font-bold hover:bg-blue-100">ØªÙ‚Ø±ÙŠØ±</button>
                    </div>
                `).join('');

                initChart(stats.total_leads || 0);

            } catch(e) { console.error(e); }
        }

        // Actions
        async function startHunt() {
            const q = document.getElementById('hunt-q').value;
            if(!q) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«', 'warning');
            
            Swal.fire({
                title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØµÙŠØ¯...',
                html: 'ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¢Ù†<br><span class="text-xs text-gray-400">Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„Ø£Ù…Ø± Ø¯Ù‚ÙŠÙ‚Ø©</span>',
                timer: 3000,
                timerProgressBar: true,
                didOpen: () => Swal.showLoading()
            });
            
            await fetch(`${API}/start_hunt`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({intent_sentence: q, city: document.getElementById('hunt-loc').value, user_id: 'admin'})
            });
        }

        async function sendMsg(phone) {
            const {value: text} = await Swal.fire({input: 'textarea', inputLabel: 'Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', showCancelButton: true});
            if(text) {
                await fetch(`${API}/api/send-whatsapp`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({phone_number: phone, message: text, user_id: 'admin'})
                });
                Swal.fire('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', '', 'success');
            }
        }

        async function createCamp(e) {
            e.preventDefault();
            const fd = new FormData(e.target);
            fd.append('user_id', 'admin');
            await fetch(`${API}/api/create-campaign`, {method: 'POST', body: fd});
            Swal.fire('ØªÙ…', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©', 'success');
            loadData();
            e.target.reset();
        }

        function openExtractModal() { document.getElementById('modal').classList.remove('hidden'); }
        async function runExtraction() {
            const t = document.getElementById('ext-text').value;
            const res = await (await fetch(`${API}/api/extract-phones`, {
                method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({text: t})
            })).json();
            document.getElementById('ext-res').classList.remove('hidden');
            document.getElementById('ext-res').innerText = res.phones.join(', ');
        }

        function initChart(leads) {
            if(chartInstance) chartInstance.destroy();
            const ctx = document.getElementById('mainChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'],
                    datasets: [{
                        label: 'Ù†Ù…Ùˆ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
                        data: [leads-5, leads-2, leads, leads+3, leads+8, leads+12, leads+15],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {legend: {display: false}},
                    scales: {y: {beginAtZero: true, grid: {display: false}}, x: {grid: {display: false}}}
                }
            });
        }
    </script>
</body>
</html>
